<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹¾æ¯ï¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Microsoft JhengHei', sans-serif;
        }

        .container {
            text-align: center;
            padding: 20px;
            position: relative;
        }

        .hint {
            color: #ffd700;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .bonus-hint {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.2);
            padding: 15px 20px;
            border-radius: 10px;
            color: #ffd700;
            font-size: 1rem;
            text-align: right;
            border: 2px solid #ffd700;
        }

        .multiplier-badge {
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .multiplier-badge.show {
            display: inline-block;
        }

        .multiplier-value {
            font-weight: bold;
            font-size: 1.2em;
        }

        .game-image {
            cursor: pointer;
            max-width: 300px;
            border-radius: 15px;
            transition: transform 0.1s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .game-image:hover {
            transform: scale(1.05);
        }

        .game-image:active {
            transform: scale(0.95);
        }

        .counter {
            margin-top: 30px;
            color: #fff;
            font-size: 2rem;
        }

        .count-number {
            color: #ffd700;
            font-size: 3rem;
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        .flash-image {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 80%;
            max-height: 80%;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.5);
        }

        .flash-image.show {
            animation: flashFade 1.5s ease-out forwards;
        }

        @keyframes flashFade {
            0% { opacity: 1; }
            30% { opacity: 1; }
            100% { opacity: 0; }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .modal-content h2 {
            color: #ffd700;
            font-size: 2rem;
            margin-bottom: 30px;
        }

        .modal-content img {
            max-width: 200px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .modal-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .modal-btn:hover {
            transform: scale(1.1);
        }

        .btn-yes {
            background: #e74c3c;
            color: white;
        }

        .btn-no {
            background: #3498db;
            color: white;
        }

        .game-over h1 {
            color: #e74c3c;
            font-size: 2.5rem;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-over p {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .thanks-screen h1 {
            color: #2ecc71;
            font-size: 2rem;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .thanks-screen p {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .prize-screen h1 {
            color: #ff69b4;
            font-size: 2.5rem;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .prize-screen p {
            color: #fff;
            font-size: 1.8rem;
            margin-bottom: 30px;
        }

        .prize-screen .game-image {
            max-width: 400px;
        }

        .action-btn {
            padding: 15px 40px;
            font-size: 1.3rem;
            background: #ffd700;
            color: #1a1a2e;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            margin: 10px;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .action-btn.patrol {
            background: #3498db;
            color: white;
        }

        .screen {
            display: none;
        }

        .screen.show {
            display: block;
        }

        .history-panel {
            position: fixed;
            left: 20px;
            top: 20px;
            background: rgba(255, 215, 0, 0.15);
            padding: 20px;
            border-radius: 15px;
            color: #ffd700;
            border: 2px solid #ffd700;
            max-width: 250px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .history-panel h3 {
            margin: 0 0 15px 0;
            font-size: 1.3rem;
            text-align: center;
        }

        .history-count {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            font-weight: bold;
        }

        .history-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .history-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
        }

        .history-item-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .prize-notification {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%) translateX(400px);
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(255, 105, 180, 0.6);
            border: 3px solid #fff;
            max-width: 300px;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 150;
        }

        .prize-notification.show {
            transform: translateY(-50%) translateX(0);
            opacity: 1;
        }

        .prize-notification img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 3px solid #fff;
        }

        .notification-text {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <!-- å³ä¸Šè§’æç¤º -->
    <div class="bonus-hint" id="bonusHint">
        ğŸ ä¹¾åˆ°300æ¬¡é€å…è²»é˜¿æ·‡ï¼
        <div class="multiplier-badge" id="multiplierBadge">x<span class="multiplier-value" id="multiplierValue">3</span> å€è¨ˆæ•¸ä¸­ï¼</div>
    </div>

    <!-- å³å´çå‹µé€šçŸ¥ -->
    <div class="prize-notification" id="prizeNotification">
        <img src="" alt="çå“" id="notificationImg">
        <div class="notification-text" id="notificationText"></div>
    </div>

    <!-- å·¦å´æ­·å²è¨˜éŒ„ -->
    <div class="history-panel" id="historyPanel">
        <h3>ğŸ† å·²ç²å¾—é˜¿æ·‡</h3>
        <div class="history-count">å…± <span id="historyCount">0</span> å€‹</div>
        <div class="history-items" id="historyItems"></div>
    </div>

    <!-- ä¹¾æ¯ç•«é¢ -->
    <div class="container screen show" id="cheersScreen">
        <p class="hint">ğŸ‘† é»æ“Šåœ–ç‰‡ä»¥ä¹¾æ¯ ğŸ»</p>
        <img src="1.png.png" alt="ä¹¾æ¯" class="game-image" id="cheersImg">
        <div class="counter">
            ä¹¾æ¯æ¬¡æ•¸
            <span class="count-number" id="cheersCount">0</span>
        </div>
    </div>

    <!-- éŠæˆ²çµæŸç•«é¢ -->
    <div class="container screen game-over" id="gameOverScreen">
        <img src="7.png.jpg" alt="é»ƒè­¦å®˜" class="game-image" style="cursor: default;">
        <h1>ğŸš” éŠæˆ²çµæŸ ğŸš”</h1>
        <p>ä½ å·²è¢«é»ƒè­¦å®˜é€®æ•ï¼</p>
        <button class="action-btn" id="restartBtn">é‡ä¾†ä¸€æ¬¡</button>
        <button class="action-btn patrol" id="patrolBtn">è·Ÿé»ƒè­¦å®˜å»å·¡é‚</button>
    </div>

    <!-- å·¡é‚ç•«é¢ -->
    <div class="container screen" id="patrolScreen">
        <p class="hint">ğŸ‘® é»æ“Šä»¥å·¡é‚ ğŸš”</p>
        <img src="7.png.jpg" alt="å·¡é‚" class="game-image" id="patrolImg">
        <div class="counter">
            å·¡é‚æ¬¡æ•¸
            <span class="count-number" id="patrolCount">0</span>
        </div>
    </div>

    <!-- æ„Ÿè¬ç•«é¢ -->
    <div class="container screen thanks-screen" id="thanksScreen">
        <img src="7.png.jpg" alt="é»ƒè­¦å®˜" class="game-image" style="cursor: default;">
        <h1>ğŸ‰ è¬è¬ä½ å¹«é»ƒè­¦å®˜é€®æ•çŠ¯äººï¼</h1>
        <p>ä½ å¯ä»¥å›å»ä¹¾æ¯äº† ğŸ»</p>
        <p style="color: #ffd700;" id="multiplierMsg">âœ¨ ä½ çš„ä¹¾æ¯æ¬¡æ•¸æœƒè®Šä¸‰å€ï¼âœ¨</p>
        <button class="action-btn" id="backToCheersBtn">å›å»ä¹¾æ¯</button>
    </div>

    <!-- çå“ç•«é¢ -->
    <div class="container screen prize-screen" id="prizeScreen">
        <img src="" alt="çå“" class="game-image" id="prizeImg" style="cursor: default;">
        <h1>ğŸŠ æ­å–œï¼ğŸŠ</h1>
        <p id="prizeText"></p>
        <button class="action-btn" id="prizeRestartBtn">å†ç©ä¸€æ¬¡</button>
    </div>

    <!-- ä¹¾æ¯å½ˆçª— -->
    <div class="modal" id="cheersModal">
        <div class="modal-content">
            <h2>ğŸº è¦ä¸è¦å¤§åŠ›æ’ä»–ï¼Ÿ ğŸº</h2>
            <div class="modal-buttons">
                <button class="modal-btn btn-yes" id="cheersYes">è¦</button>
                <button class="modal-btn btn-no" id="cheersNo">ä¸è¦</button>
            </div>
        </div>
    </div>

    <!-- å·¡é‚å½ˆçª— -->
    <div class="modal" id="patrolModal">
        <div class="modal-content">
            <img src="4.png.jpg" alt="è»Šæ‰‹">
            <h2>ğŸš¨ è¦ä¸è¦é€®æ•é€™å€‹è»Šæ‰‹ï¼Ÿ ğŸš¨</h2>
            <div class="modal-buttons">
                <button class="modal-btn btn-yes" id="patrolYes">è¦</button>
                <button class="modal-btn btn-no" id="patrolNo">ä¸è¦</button>
            </div>
        </div>
    </div>

    <!-- é–ƒç¾åœ–ç‰‡ -->
    <img src="3.png.jpg" alt="é–ƒç¾" class="flash-image" id="flashImg">

    <audio id="cheersSound" src="1.mp3"></audio>
    <audio id="crashSound" src="2.mp3"></audio>
    <audio id="patrolSound" src="3.mp3"></audio>

    <script>
        const cheersScreen = document.getElementById('cheersScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const patrolScreen = document.getElementById('patrolScreen');
        const thanksScreen = document.getElementById('thanksScreen');
        const prizeScreen = document.getElementById('prizeScreen');
        const cheersImg = document.getElementById('cheersImg');
        const patrolImg = document.getElementById('patrolImg');
        const prizeImg = document.getElementById('prizeImg');
        const prizeText = document.getElementById('prizeText');
        const cheersCountDisplay = document.getElementById('cheersCount');
        const patrolCountDisplay = document.getElementById('patrolCount');
        const cheersModal = document.getElementById('cheersModal');
        const patrolModal = document.getElementById('patrolModal');
        const flashImg = document.getElementById('flashImg');
        const bonusHint = document.getElementById('bonusHint');
        const multiplierBadge = document.getElementById('multiplierBadge');
        const multiplierValue = document.getElementById('multiplierValue');
        const multiplierMsg = document.getElementById('multiplierMsg');
        const historyPanel = document.getElementById('historyPanel');
        const historyCount = document.getElementById('historyCount');
        const historyItems = document.getElementById('historyItems');
        const prizeNotification = document.getElementById('prizeNotification');
        const notificationImg = document.getElementById('notificationImg');
        const notificationText = document.getElementById('notificationText');

        const cheersSound = document.getElementById('cheersSound');
        const crashSound = document.getElementById('crashSound');
        const patrolSound = document.getElementById('patrolSound');

        const restartBtn = document.getElementById('restartBtn');
        const patrolBtn = document.getElementById('patrolBtn');
        const backToCheersBtn = document.getElementById('backToCheersBtn');
        const prizeRestartBtn = document.getElementById('prizeRestartBtn');
        const cheersYes = document.getElementById('cheersYes');
        const cheersNo = document.getElementById('cheersNo');
        const patrolYes = document.getElementById('patrolYes');
        const patrolNo = document.getElementById('patrolNo');

        const prizes = [
            { id: 'baseball', img: '2.png.jpg', text: 'ä½ ç²å¾—æ£’çƒé˜¿æ·‡ï¼âš¾', rarity: 'N', weight: 49.5 },
            { id: 'cat', img: '5.png.jpg', text: 'ä½ ç²å¾—å¯æ„›å–µå–µé˜¿æ·‡ï¼ğŸ±', rarity: 'SSR', weight: 1 },
            { id: 'girl', img: '6.png.jpg', text: 'ä½ ç²å¾—é•·é«®è¾£å¦¹é˜¿æ·‡ï¼ğŸ’ƒ', rarity: 'N', weight: 49.5 }
        ];

        let prizeHistory = prizes.map(prize => ({ ...prize, count: 0 }));

        function getRandomTrigger() {
            const baseMin = 5;
            const baseMax = 20;
            const multiplierBonus = (multiplier - 1) * 10;
            const min = baseMin + multiplierBonus;
            const max = baseMax + multiplierBonus;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRandomPatrolTrigger() {
            return Math.floor(Math.random() * 5) + 1;
        }

        let cheersCount = 0;
        let clickCount = 0;
        let patrolCount = 0;
        let multiplier = 1; // åˆå§‹1å€ï¼ˆæ²¡æœ‰å–µå–µï¼‰
        let cheersMult = 1; // ä¹¾æ¯å€æ•¸åˆå§‹1å€
        let patrolMult = 1; // å·¡é‚å€æ•¸åˆå§‹1å€
        let cheersTrigger = getRandomTrigger();
        let patrolTrigger = getRandomPatrolTrigger();

        function getRandomPrize() {
            const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let prize of prizes) {
                random -= prize.weight;
                if (random <= 0) {
                    return prize;
                }
            }
            return prizes[0];
        }

        function addToHistory(prize) {
            const existing = prizeHistory.find(p => p.id === prize.id);
            if (existing) {
                existing.count++;
            } else {
                prizeHistory.push({ ...prize, count: 1 });
            }
            updateHistoryDisplay();
            
            // æª¢æŸ¥æ˜¯å¦éœ€è¦é€ç´‘ç„™
            checkAndRewardCat();
            updateMultiplierByCat();
        }

        function checkAndRewardCat() {
            const totalCount = prizeHistory.reduce((sum, p) => sum + p.count, 0);
            // æ¯100å€‹é˜¿æ·‡é€ä¸€å€‹ç´‘ç„™
            const catRewards = Math.floor(totalCount / 100);
            const catItem = prizeHistory.find(p => p.id === 'cat');
            
            if (catItem && catItem.count < catRewards) {
                catItem.count = catRewards;
                updateHistoryDisplay();
            }
        }

        function updateMultiplierByCat() {
            const catItem = prizeHistory.find(p => p.id === 'cat');
            const catCount = catItem ? catItem.count : 0;
            
            // æ¯å€‹å–µå–µ+5å€ï¼š0å€‹->1å€ 1å€‹->6å€ 2å€‹->11å€ 3å€‹->16å€
            cheersMult = 1 + (catCount * 5);
            
            // ç¸½å€æ•¸ = ä¹¾æ¯å€æ•¸ * å·¡é‚å€æ•¸
            multiplier = cheersMult * patrolMult;
            updateMultiplierBadge();
        }

        function updateHistoryDisplay() {
            const totalCount = prizeHistory.reduce((sum, p) => sum + p.count, 0);
            historyCount.textContent = totalCount;
            historyItems.innerHTML = '';
            prizeHistory.forEach((prize) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                const rarityTag = prize.rarity === 'SSR' ? ' <span style="color: #ff69b4; font-weight: bold;">(SSR)</span>' : '';
                item.innerHTML = `
                    <img src="${prize.img}" alt="é˜¿æ·‡">
                    <div class="history-item-text">
                        ${prize.text.replace('ä½ ç²å¾—', '').replace(/[ï¼!]/g, '')}${rarityTag}
                        <br><strong>x ${prize.count}</strong>
                    </div>
                `;
                historyItems.appendChild(item);
            });
        }

        function showScreen(screen) {
            cheersScreen.classList.remove('show');
            gameOverScreen.classList.remove('show');
            patrolScreen.classList.remove('show');
            thanksScreen.classList.remove('show');
            prizeScreen.classList.remove('show');
            screen.classList.add('show');

            // åªåœ¨ä¹¾æ¯ç•«é¢é¡¯ç¤ºå³ä¸Šè§’æç¤º
            bonusHint.style.display = (screen === cheersScreen) ? 'block' : 'none';
            // å·¦å´æ¬„å§‹çµ‚é¡¯ç¤º
            historyPanel.style.display = 'block';
        }

        function flashImage() {
            flashImg.classList.remove('show');
            void flashImg.offsetWidth;
            flashImg.classList.add('show');
        }

        function updateMultiplierBadge() {
            if (multiplier > 1) {
                multiplierBadge.classList.add('show');
                multiplierValue.textContent = multiplier;
            } else {
                multiplierBadge.classList.remove('show');
            }
        }

        function showPrize() {
            const prize = getRandomPrize();
            addToHistory(prize);
            
            // é¡¯ç¤ºå³å´é€šçŸ¥
            notificationImg.src = prize.img;
            notificationText.textContent = prize.text;
            prizeNotification.classList.add('show');
            
            // 3ç§’å¾Œéš±è—é€šçŸ¥
            setTimeout(() => {
                prizeNotification.classList.remove('show');
            }, 3000);
            
            // ä¸è¦é‡ç½®cheersCountï¼Œç¹¼çºŒç´¯è¨ˆ
        }

        function resetGame() {
            cheersCount = 0;
            clickCount = 0;
            lastPrizeCount = 0; // é‡ç½®çå“é–€æª»
            cheersCountDisplay.textContent = 0;
            cheersTrigger = getRandomTrigger();
            patrolMult = 1; // é‡ç½®å·¡é‚å€æ•¸
            // æ ¹æ“šå–µå–µæ•¸é‡é‡æ–°è¨ˆç®—å€æ•¸
            updateMultiplierByCat();
        }

        let lastPrizeCount = 0; // ä¸Šæ¬¡ç²å¾—çå“æ™‚çš„ä¹¾æ¯æ¬¡æ•¸é–€æª»

        cheersImg.addEventListener('click', () => {
            cheersSound.currentTime = 0;
            cheersSound.play();
            clickCount++;
            cheersCount += multiplier;
            cheersCountDisplay.textContent = cheersCount;

            // æ¯300æ¬¡é€ä¸€å€‹éš¨æ©Ÿé˜¿æ·‡ï¼ˆæ£’çƒ49.5%ã€è¾£å¦¹49.5%ã€å–µå–µ1%ï¼‰
            const prizeThreshold = Math.floor(cheersCount / 300);
            if (prizeThreshold > lastPrizeCount) {
                // è¨ˆç®—è¦çµ¦å¹¾å€‹é˜¿æ·‡
                const prizesToGive = prizeThreshold - lastPrizeCount;
                lastPrizeCount = prizeThreshold;
                
                // æ‰¹é‡è™•ç†é˜¿æ·‡
                let baseballCount = 0;
                let catCount = 0;
                let girlCount = 0;
                
                for (let i = 0; i < prizesToGive; i++) {
                    const rand = Math.random() * 100;
                    if (rand < 1) {
                        catCount++; // 1%æ©Ÿç‡æŠ½åˆ°å–µå–µ
                    } else if (rand < 50.5) {
                        baseballCount++;
                    } else {
                        girlCount++;
                    }
                }
                
                // ä¸€æ¬¡æ€§æ›´æ–°æ­·å²è¨˜éŒ„
                const baseballItem = prizeHistory.find(p => p.id === 'baseball');
                const catItem = prizeHistory.find(p => p.id === 'cat');
                const girlItem = prizeHistory.find(p => p.id === 'girl');
                
                if (baseballItem) baseballItem.count += baseballCount;
                if (catItem) catItem.count += catCount;
                if (girlItem) girlItem.count += girlCount;
                
                // æª¢æŸ¥æ˜¯å¦é”åˆ°300å€‹é˜¿æ·‡ï¼ˆæ£’çƒ+è¾£å¦¹ï¼‰é€é¡å¤–å–µå–µ
                const totalNormalPrizes = (baseballItem ? baseballItem.count : 0) + (girlItem ? girlItem.count : 0);
                const expectedBonusCats = Math.floor(totalNormalPrizes / 300);
                const currentCats = catItem ? catItem.count : 0;
                // è¨ˆç®—æ‡‰è©²æœ‰çš„å–µå–µæ•¸ï¼ˆæŠ½åˆ°çš„ + çå‹µçš„ï¼‰
                // ç”¨ä¸€å€‹è®Šæ•¸è¨˜éŒ„å·²ç¶“çµ¦éçš„çå‹µå–µå–µ
                if (!window.bonusCatsGiven) window.bonusCatsGiven = 0;
                const bonusCatsToAdd = expectedBonusCats - window.bonusCatsGiven;
                
                if (bonusCatsToAdd > 0 && catItem) {
                    catItem.count += bonusCatsToAdd;
                    window.bonusCatsGiven = expectedBonusCats;
                    catCount += bonusCatsToAdd; // åŠ åˆ°é€šçŸ¥é¡¯ç¤º
                }
                
                updateHistoryDisplay();
                updateMultiplierByCat();
                
                // é¡¯ç¤ºå³å´é€šçŸ¥
                if (prizesToGive > 0) {
                    let notifyText = `ä¸€æ¬¡ç²å¾— ${prizesToGive} å€‹é˜¿æ·‡ï¼`;
                    if (catCount > 0) {
                        notifyText = `ğŸ‰ ç²å¾— ${catCount} å€‹å–µå–µï¼å…± ${prizesToGive} å€‹é˜¿æ·‡`;
                        notificationImg.src = '5.png.jpg';
                    } else {
                        notificationImg.src = Math.random() < 0.5 ? '2.png.jpg' : '6.png.jpg';
                    }
                    notificationText.textContent = notifyText;
                    prizeNotification.classList.add('show');
                    
                    setTimeout(() => {
                        prizeNotification.classList.remove('show');
                    }, 3000);
                }
            }

            if (clickCount >= cheersTrigger) {
                cheersModal.classList.add('show');
            }
        });

        cheersYes.addEventListener('click', () => {
            cheersModal.classList.remove('show');
            crashSound.currentTime = 0;
            crashSound.play();
            showScreen(gameOverScreen);
        });

        cheersNo.addEventListener('click', () => {
            cheersModal.classList.remove('show');
            flashImage();
            cheersTrigger = clickCount + getRandomTrigger();
        });

        restartBtn.addEventListener('click', () => {
            resetGame();
            showScreen(cheersScreen);
        });

        patrolBtn.addEventListener('click', () => {
            patrolCount = 0;
            patrolCountDisplay.textContent = 0;
            patrolTrigger = getRandomPatrolTrigger();
            showScreen(patrolScreen);
        });

        patrolImg.addEventListener('click', () => {
            cheersSound.currentTime = 0;
            cheersSound.play();
            patrolCount++;
            patrolCountDisplay.textContent = patrolCount;

            if (patrolCount === patrolTrigger) {
                patrolSound.currentTime = 0;
                patrolSound.play();
                patrolModal.classList.add('show');
            }
        });

        patrolYes.addEventListener('click', () => {
            patrolModal.classList.remove('show');
            // å·¡é‚å€æ•¸ç–‘åŠ 3å€
            patrolMult *= 3;
            // é‡æ–°è¨ˆç®—ç¸½å€æ•¸
            multiplier = cheersMult * patrolMult;
            // æ›´æ–°æ„Ÿè¬ç•«é¢çš„è¨Šæ¯
            multiplierMsg.textContent = `âœ¨ ä½ çš„ä¹¾æ¯å€æ•¸ç¾åœ¨æ˜¯ ${multiplier} å€ï¼âœ¨`;
            showScreen(thanksScreen);
        });

        patrolNo.addEventListener('click', () => {
            patrolModal.classList.remove('show');
            patrolTrigger = patrolCount + getRandomPatrolTrigger();
        });

        backToCheersBtn.addEventListener('click', () => {
            cheersTrigger = clickCount + getRandomTrigger();
            updateMultiplierByCat();
            showScreen(cheersScreen);
        });

        prizeRestartBtn.addEventListener('click', () => {
            resetGame();
            showScreen(cheersScreen);
        });

        // åˆå§‹åŒ–æ­·å²é¡¯ç¤º
        updateHistoryDisplay();
        historyPanel.style.display = 'block';
    </script>
</body>
</html>
